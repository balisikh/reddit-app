<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reddit Clone</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <header class="header">
        <div class="header-container">
            <h1>Reddit Clone</h1>
            <div class="auth-links">
                <a href="#">Log In</a>
                <a href="#">Sign Up</a>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="search-section">
            <input type="text" placeholder="Search posts..." class="search-input">
            <button class="search-button">Search</button>
        </div>

        <div class="posts-container">
            <div class="post-card">
                <h2>Learning React</h2>
                <p>React is a library for building user interfaces.</p>
                <p class="author">Author: John Doe</p>
            </div>
            
            <div class="post-card">
                <h2>Understanding Redux</h2>
                <p>Redux is a state management tool</p>
                <p class="author">Author: John Doe</p>
            </div>
            
            <div class="post-card">
                <h2>Styling with CSS</h2>
                <p>CSS is used to style web pages</p>
                <p class="author">Author: John Doe</p>
            </div>
        </div>
    </main>
    <script src="index.js"></script>
    <script>
        const postsContainer = document.querySelector('.posts-container');
        const searchInput = document.querySelector('.search-input');
        const searchButton = document.querySelector('.search-button');
        
        let lastRequestTime = 0;
        const RATE_LIMIT_MS = 2000; // 2 seconds between requests
        
        /**
         * Renders an error message in the posts container.
         * @param {string} message The error message to display.
         */
        function renderError(message) {
            postsContainer.innerHTML = `<div class="error-message">${message}</div>`;
        }

        /**
         * Renders a loading message in the posts container.
         */
        function renderLoading() {
            postsContainer.innerHTML = `<div class="loading-message">Loading Reddit posts...</div>`;
        }

        /**
         * Renders a single Reddit post card.
         * @param {object} post The post data.
         * @returns {string} The HTML string for the post card.
         */
        function renderPostCard(post) {
            const author = post.data.author || 'Anonymous';
            const title = post.data.title || 'No Title';
            const text = post.data.selftext || 'No content available.';

            return `
                <div class="post-card">
                    <h2>${title}</h2>
                    <p>${text.substring(0, 150)}...</p>
                    <p class="author">Author: ${author}</p>
                </div>
            `;
        }

        /**
         * Fetches and displays Reddit posts for a given subreddit.
         * @param {string} subreddit The subreddit to fetch posts from.
         */
        async function fetchRedditPosts(subreddit) {
            const now = Date.now();
            if (now - lastRequestTime < RATE_LIMIT_MS) {
                renderError('You are making requests too quickly. Please wait a moment and try again.');
                return;
            }
            lastRequestTime = now;
            
            renderLoading();
            
            try {
                const url = `https://www.reddit.com/r/${subreddit}/hot.json?limit=10`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    if (response.status === 429) {
                        throw new Error('API Rate Limit Exceeded. Please try again in a minute.');
                    }
                    throw new Error(`Error fetching posts: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.data.children.length === 0) {
                    renderError(`No posts found for r/${subreddit}.`);
                    return;
                }
                
                const postsHtml = data.data.children.map(renderPostCard).join('');
                postsContainer.innerHTML = postsHtml;
            } catch (error) {
                console.error('Fetch error:', error);
                renderError(`Failed to load posts: ${error.message}`);
            }
        }
        
        // Initial fetch on page load
        fetchRedditPosts('javascript'); // Default subreddit

        // Event listeners for search
        searchButton.addEventListener('click', () => {
            const subreddit = searchInput.value.trim() || 'javascript';
            fetchRedditPosts(subreddit);
        });
        
        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const subreddit = searchInput.value.trim() || 'javascript';
                fetchRedditPosts(subreddit);
            }
        });

    </script>
</body>
</html>